<template>
    <div class="page" data-name="child">
        <div class="navbar">
        <div class="navbar-inner sliding">
            <div class="left">
                <a href="#" class="link icon-only back">
                    <i class="icon f7-icons ios-only">close</i>
                    <i class="icon material-icons md-only">close</i>
                </a>
            </div>  
            <div class="title">Enfant</div>
            <div class="right">
                <a href="#" class="link icon-only" id="btnOK">
                    <i class="icon f7-icons ios-only">check</i>
                    <i class="icon material-icons md-only">check</i>
                </a>
            </div>
        </div>
        </div>
        <div class="page-content">
            <div class="block-title">Informations </div>
            <div class="list no-hairlines-md">
                <ul>
                    <li>
                        <div class="item-content item-input">
                            <div class="item-inner">
                                <div class="item-title item-label">Prénom</div>
                                <div class="item-input-wrap">
                                    <input id="edtFirstName" type="text" placeholder="le prénom de l'enfant" value="{{#if child}}{{child.firstname}}{{/if}}"/>
                                </div>
                            </div>
                        </div>
                    </li>
                    <li>
                        <div class="item-content item-input">
                            <div class="item-inner">
                                <div class="item-title item-label">Nom</div>
                                <div class="item-input-wrap">
                                    <input id="edtFamilyName" type="text" placeholder="Nom de l'enfant" value="{{#if child}}{{child.familyname}}{{/if}}"/>
                                </div>
                            </div>
                        </div>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</template>
<script>
  return {
    data: function () {
      return {
      };
    },
    // Page Events
    on: {
      pageInit: function(e, page) {
        console.log('pageInit', page.name);
        $$('#btnOK').on('click', function () {
            console.log('On Valid');
            var router = app.views.current.router; 
            if (router.currentRoute.params.childId) // si c'est une mise à jour 
            {
                console.log('Mise à jour d enfant');
                var aChild = {
                        id: router.currentRoute.params.childId,
                        firstname: $$('#edtFirstName').val(),
                        familyname: $$('#edtFamilyName').val()
                    };
                console.log('AChild: ' + aChild.firstname + ', ' + aChild.familyname);
                //app.request({'method': 'PUT'});
                app.request({'method': 'PUT'}).postJSON('/api/Children', aChild, 
                    function(data, status, xhr)
                    {

                    },
                    function(xhr, status)
                    {

                    },
                    'json'
                );
            }
            else // si c'est un ajout
            {
                console.log('Ajout d enfant');
                var aChild = {
                        firstname: $$('#edtFirstName').val(),
                        familyname: $$('#edtFamilyName').val()
                    };
                console.log('AChild: ' + aChild.firstname + ', ' + aChild.familyname);
                app.request.postJSON('/api/Children', aChild, 
                    function(data, status, xhr)
                    {

                    },
                    function(xhr, status)
                    {

                    },
                    'json'
                );
            }
        });
      }
    }
  };
</script>